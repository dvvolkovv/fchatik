<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç —Å—Ç—Ä–∏–º–∏–Ω–≥–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        h1 { color: #10a37f; }
        .output-box {
            border: 2px solid #333;
            padding: 20px;
            min-height: 150px;
            background: #0f0f0f;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 20px 0;
            font-size: 18px;
            line-height: 1.6;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            background: #10a37f;
            color: white;
            border: none;
            border-radius: 5px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #0d8c6a;
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        .cursor {
            animation: blink 1s infinite;
            color: #10a37f;
        }
        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }
        .log {
            background: #222;
            padding: 8px 12px;
            margin: 5px 0;
            font-family: monospace;
            font-size: 12px;
            border-left: 3px solid #10a37f;
        }
        .log.error {
            border-left-color: #ef4444;
        }
        .log.success {
            border-left-color: #22c55e;
        }
        #logs {
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 15px;
            background: #222;
            border-radius: 8px;
        }
        .stat {
            flex: 1;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #10a37f;
        }
        .stat-label {
            font-size: 12px;
            color: #888;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ SSE</h1>
    <p style="color: #888;">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞</p>
    
    <div>
        <button onclick="testJavaScriptStream()">1Ô∏è‚É£ –¢–µ—Å—Ç JavaScript (—Å–∏–º—É–ª—è—Ü–∏—è)</button>
        <button onclick="testSlowStream()">2Ô∏è‚É£ –ú–µ–¥–ª–µ–Ω–Ω—ã–π —Å—Ç—Ä–∏–º (200ms)</button>
        <button onclick="testFastStream()">3Ô∏è‚É£ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç—Ä–∏–º (50ms)</button>
        <button onclick="testInstantStream()">4Ô∏è‚É£ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Å—Ç—Ä–∏–º (1ms)</button>
        <button onclick="clearAll()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>

    <div class="stats">
        <div class="stat">
            <div class="stat-value" id="chunkCount">0</div>
            <div class="stat-label">–ß–∞–Ω–∫–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="totalChars">0</div>
            <div class="stat-label">–°–∏–º–≤–æ–ª–æ–≤</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="duration">0ms</div>
            <div class="stat-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="speed">0</div>
            <div class="stat-label">–ß–∞–Ω–∫–æ–≤/—Å–µ–∫</div>
        </div>
    </div>
    
    <h3>üì∫ –í—ã–≤–æ–¥:</h3>
    <div id="output" class="output-box"></div>
    
    <h3>üìã –õ–æ–≥–∏:</h3>
    <div id="logs"></div>

    <script>
        let startTime;
        let chunkCount = 0;
        let totalChars = 0;
        
        function updateStats() {
            const elapsed = Date.now() - startTime;
            const speed = chunkCount > 0 ? (chunkCount / (elapsed / 1000)).toFixed(1) : 0;
            
            document.getElementById('chunkCount').textContent = chunkCount;
            document.getElementById('totalChars').textContent = totalChars;
            document.getElementById('duration').textContent = elapsed + 'ms';
            document.getElementById('speed').textContent = speed;
        }
        
        function log(message, type = 'info') {
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            const logsContainer = document.getElementById('logs');
            logsContainer.appendChild(logDiv);
            logsContainer.scrollTop = logsContainer.scrollHeight;
            console.log(message);
        }
        
        function clearAll() {
            document.getElementById('output').textContent = '';
            document.getElementById('logs').innerHTML = '';
            chunkCount = 0;
            totalChars = 0;
            updateStats();
        }
        
        async function streamText(text, delayMs, label) {
            clearAll();
            log(`üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞: ${label}`, 'info');
            log(`‚è±Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏: ${delayMs}ms`, 'info');
            
            const output = document.getElementById('output');
            const words = text.split(' ');
            
            startTime = Date.now();
            chunkCount = 0;
            totalChars = 0;
            
            for (let i = 0; i < words.length; i++) {
                const word = words[i] + ' ';
                
                // –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∫—É—Ä—Å–æ—Ä
                const oldCursor = output.querySelector('.cursor');
                if (oldCursor) oldCursor.remove();
                
                // –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç
                const textNode = document.createTextNode(word);
                output.appendChild(textNode);
                
                // –î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å–æ—Ä
                const cursor = document.createElement('span');
                cursor.className = 'cursor';
                cursor.textContent = '‚ñã';
                output.appendChild(cursor);
                
                chunkCount++;
                totalChars += word.length;
                
                if (i % 5 === 0 || i === words.length - 1) {
                    log(`üì¶ Chunk ${i + 1}/${words.length}: "${word}" (+${word.length} chars)`);
                }
                
                // –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π reflow –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
                output.offsetHeight;
                
                updateStats();
                
                // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º —á–∞–Ω–∫–æ–º
                if (i < words.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, delayMs));
                }
            }
            
            // –£–±—Ä–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å–æ—Ä
            const finalCursor = output.querySelector('.cursor');
            if (finalCursor) finalCursor.remove();
            
            const elapsed = Date.now() - startTime;
            log(`‚úÖ –°—Ç—Ä–∏–º –∑–∞–≤–µ—Ä—à–µ–Ω –∑–∞ ${elapsed}ms`, 'success');
            log(`üìä –í—Å–µ–≥–æ: ${chunkCount} —á–∞–Ω–∫–æ–≤, ${totalChars} —Å–∏–º–≤–æ–ª–æ–≤`, 'success');
        }
        
        function testJavaScriptStream() {
            const text = "–≠—Ç–æ —Ç–µ—Å—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞. –ö–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–ª—è—Ç—å—Å—è –ø–æ –æ—á–µ—Ä–µ–¥–∏ —Å –≤–∏–¥–∏–º–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π. –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –≤—Å–µ —Å–ª–æ–≤–∞ —Å—Ä–∞–∑—É –∑–Ω–∞—á–∏—Ç —Å—Ç—Ä–∏–º–∏–Ω–≥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Å–ª–æ–≤–∞ –ø–æ—è–≤–ª—è—é—â–∏–µ—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Å—Ç—Ä–∏–º–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ!";
            streamText(text, 200, "JavaScript —Å–∏–º—É–ª—è—Ü–∏—è (200ms)");
        }
        
        function testSlowStream() {
            const text = "–ú–µ–¥–ª–µ–Ω–Ω—ã–π —Å—Ç—Ä–∏–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–≤–µ—Å—Ç–∏ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É —Å–ª–æ–≤–∞–º–∏ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏";
            streamText(text, 200, "–ú–µ–¥–ª–µ–Ω–Ω—ã–π —Å—Ç—Ä–∏–º (200ms)");
        }
        
        function testFastStream() {
            const text = "–ë—ã—Å—Ç—Ä—ã–π —Å—Ç—Ä–∏–º –∏–º–∏—Ç–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI –º–æ–¥–µ–ª–∏ –∫–æ–≥–¥–∞ —Å–ª–æ–≤–∞ –ø–æ—è–≤–ª—è—é—Ç—Å—è –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ –Ω–æ –≤—Å–µ –µ—â–µ –∑–∞–º–µ—Ç–Ω–æ —á—Ç–æ –æ–Ω–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∞ –Ω–µ –≤—Å–µ —Å—Ä–∞–∑—É —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã";
            streamText(text, 50, "–ë—ã—Å—Ç—Ä—ã–π —Å—Ç—Ä–∏–º (50ms)");
        }
        
        function testInstantStream() {
            const text = "–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Å—Ç—Ä–∏–º —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤ –æ–¥–Ω—É –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—É –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∫–æ–≥–¥–∞ —Ç–µ–∫—Å—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —á–∞–Ω–∫ –∑–∞ —á–∞–Ω–∫–æ–º —ç—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏";
            streamText(text, 1, "–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Å—Ç—Ä–∏–º (1ms)");
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–≥–æ —Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
        setTimeout(() => {
            log('üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∞', 'info');
        }, 500);
    </script>
</body>
</html>
